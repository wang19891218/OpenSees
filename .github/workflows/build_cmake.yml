
name: Make Build

env:
  # CMAKE_VERSION: 3.20.1 
  # BUILD_TYPE: Debug
  USERNAME: wang19891218
  OPENSEESVERSOIN: v3.2.0

on:
  workflow_dispatch
  # [ push ]
    # branches: [cmake-build]

jobs:
  build-ubuntu:
    name: ubuntu_build
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
      #     - uses: claudioperez/OpenSees@cmake-build
      # with: {ref: cmake-build}
      # - uses: lhotari/action-upterm@v1

    - name: Install Tcl
      run: |
        sudo apt-get update
        sudo apt-get install tcl-dev libmysqlclient-dev \
          make tcl8.6 tcl8.6-dev gcc g++ gfortran python3-dev libatlas-base-dev 

    - name: Build
      run: |
        # git pull
        git checkout tags/$OPENSEESVERSOIN
        mkdir $HOME/bin
        mkdir $HOME/lib
        cp -r ../OpenSees $HOME/
        
        cp $HOME/OpenSees/MAKES/Makefile.def.EC2-UBUNTU $HOME/OpenSees/Makefile.def
        cd $HOME/OpenSees
        
        ls -lah
        sed -i 's/\.\/usr\/local/\/usr\/local/g' Makefile.def                                  │·································
        sed -i 's/\.\/home/\/home/g' Makefile.def
        
        make
        
        mkdir $HOME/OpenSees_$OPENSEESVERSOIN
        mv $HOME/bin $HOME/OpenSees_$OPENSEESVERSOIN/
        mv $HOME/lib $HOME/OpenSees_$OPENSEESVERSOIN/
        
#       cd build
#       cmake ..
#       cmake --build . --target OpenSeesTcl -j5

# Not building on Windows until we can figure out how to use Fortran
# with Github Actions
    #  build-win32:
    #    name: Build on Windows
    #    runs-on: [windows-latest]
    #    steps:
    #    - name: Checkout sources
    #      uses: actions/checkout@v2
    #      with: {ref: cmake-build}
    #    
    #    - name: Install Conan
    #      uses: turtlebrowser/get-conan@main
    #
    #    - name: Build
    #      run: |
    #        mkdir build
    #        cd build
    #        cmake ..
    #        cmake --build . --target OpenSeesTcl -j5


